# MenuBar

## Назначение
MenuBar предоставляет панель меню для управления файлами и подключениями в приложении. Интегрируется с Electron API для работы с файловой системой и поддерживает различные типы меню (Файл, Подключение). Обрабатывает создание, открытие, сохранение файлов и управление серийными портами.

## Основные переменные состояния

| Переменная      | Тип      | Описание                                                        |
|-----------------|----------|-----------------------------------------------------------------|
| serialPorts     | array    | Массив доступных серийных портов                               |

## Контексты (useContext)
- `FileContext` — для управления файлами и workspace'ами

## Хуки
- `useState` — для управления списком серийных портов
- `useRef` — для ссылки на скрытый input файла
- `useEffect` — для инициализации списка портов
- `useContext` — для доступа к FileContext

## Props

| Prop            | Тип      | Описание                                                        |
|-----------------|----------|-----------------------------------------------------------------|
| title           | string   | Заголовок меню (например, "Файл", "Подключение")              |
| flag            | string   | Флаг для определения типа меню ("1" - файл, "3" - подключение) |

## Используемые компоненты
- `Dropdown` из Ant Design — выпадающее меню
- `Button` из Ant Design — кнопка меню
- `Space` из Ant Design — контейнер для элементов
- `Checkbox` из Ant Design — чекбоксы для портов

## Структура компонента
```jsx
<div>
  <Space>
    <Dropdown menu={{ items, onClick: handleMenuClick }}>
      <Button icon={iconbutton}>{title}</Button>
    </Dropdown>
  </Space>
  <input type="file" ref={fileInputRef} style={{ display: 'none' }} />
</div>
```

## Типы меню

### Файловое меню (flag="1")
```javascript
const MenuItem1 = [
  { key: 'new', label: 'Новый файл' },
  { key: 'open', label: 'Открыть файл' },
  { key: 'save', label: 'Сохранить' },
  { key: 'saveAs', label: 'Сохранить Как' }
];
```

### Меню подключения (flag="3")
```javascript
const connectionMenu = [
  {
    key: '1',
    label: 'Порт',
    children: serialPorts.length > 0 
      ? serialPorts 
      : [{ key: 'no-devices', label: 'Нет подключенных плат' }]
  },
  {
    key: '2',
    label: 'Обновить'
  }
];
```

## Методы управления

| Метод            | Аргументы         | Возвращаемое значение | Описание                                                        |
|------------------|-------------------|----------------------|-----------------------------------------------------------------|
| handleMenuClick  | e (event)         | void                 | Обрабатывает клики по пунктам меню                             |
| handleSave       | -                 | void                 | Сохраняет текущий файл                                          |
| handleSaveAs     | -                 | void                 | Сохраняет файл как новый                                        |
| handleFileSelect | event             | void                 | Обрабатывает выбор файла через input                           |
| fetchDevices     | -                 | Promise void         | Получает список серийных портов                                |

## Интеграция с Electron

### События отправляемые в Electron:
- `new-file` — создание нового файла
- `save-file` — сохранение файла
- `save-file-as` — сохранение файла как
- `file-opened` — файл открыт
- `connectSerialDevice` — подключение к серийному порту

### События получаемые от Electron:
- `getSerialDevices` — получение списка портов

## Пример использования
```javascript
import MenuBar from '../MenuBar/MenuBar';

// Файловое меню
<MenuBar title="Файл" flag="1" />

// Меню подключения
<MenuBar title="Подключение" flag="3" />
```

## Особенности
- Поддерживает различные типы меню через флаг
- Интегрируется с Electron API для работы с файлами
- Автоматически обновляет список серийных портов
- Поддерживает drag & drop файлов
- Использует скрытый input для выбора файлов
- Обрабатывает ошибки при работе с API
- Поддерживает подключение к серийным портам

## Стилизация
- Использует Ant Design компоненты
- Поддерживает темную тему
- Кастомные стили для чекбоксов портов
- Адаптивный дизайн

## Обработка ошибок
- Проверяет наличие Electron API перед использованием
- Выводит предупреждения в консоль при отсутствии API
- Graceful fallback при ошибках загрузки файлов
- Обработка ошибок при работе с серийными портами

## Безопасность
- Валидация типов файлов (только .json)
- Проверка содержимого файлов перед загрузкой
- Безопасная обработка путей к файлам
- Очистка input после использования

## Производительность
- Мемоизация списка портов
- Оптимизированная обработка событий
- Эффективная работа с файловой системой
- Минимальные перерендеры компонента 