# FieldButton.js — подробная документация

## Назначение
`FieldButton.js` реализует кастомное поле для Blockly, которое отображается как интерактивная кнопка внутри блока. Это расширение стандартного поля Blockly, позволяющее добавлять в блоки кнопки с кастомным поведением.

---

## Основные элементы

### Класс: `FieldButton`

#### Конструктор
```js
constructor(text, validator = null, config = {})
```
- **text** (`string`) — текст, который будет отображаться на кнопке.
- **validator** (`function`, опционально) — функция-валидатор, вызывается при изменении значения поля.
- **config** (`object`, опционально) — объект с дополнительными настройками:
  - `onClick` (`function`) — обработчик клика по кнопке.
  - `className` (`string`) — CSS-класс для стилизации кнопки.
  - `disabled` (`boolean`) — если true, кнопка неактивна.

#### Пример использования конструктора:
```jsx
<FieldButton text="Запустить" validator={null} config={{ onClick: () => alert('Кнопка нажата!'), className: 'my-button', disabled: false }} />
```

---

### Основные методы

#### `initView()`
- **Назначение:**  
  Создает DOM-элемент кнопки, добавляет его в SVG-структуру блока, навешивает обработчик событий.
- **Что делает:**  
  - Создает SVG-элемент `<foreignObject>`, внутри которого размещается HTML-кнопка.
  - Применяет стили и классы.
  - Навешивает обработчик клика, если он задан в `config`.

#### `setValue(newValue)`
- **Назначение:**  
  Устанавливает новое значение для поля (текст кнопки).
- **Параметры:**  
  - `newValue` (`string`) — новый текст кнопки.
- **Что делает:**  
  - Обновляет отображаемый текст на кнопке.
  - Вызывает валидатор, если он задан.

#### `getValue()`
- **Назначение:**  
  Возвращает текущее значение поля (текст кнопки).
- **Возвращает:**  
  - `string` — текущий текст кнопки.

#### `setEnabled(enabled)`
- **Назначение:**  
  Включает или отключает кнопку.
- **Параметры:**  
  - `enabled` (`boolean`) — если false, кнопка становится неактивной.

#### `dispose()`
- **Назначение:**  
  Очищает ресурсы, удаляет обработчики событий и DOM-элементы, связанные с полем.

---

## Пример использования в блоке
```jsx
<Blockly.Blocks['block_with_button'] = {
  init: function() {
    this.appendDummyInput()
      .appendField(new FieldButton('Кликни меня', null, {
        onClick: () => alert('Кнопка нажата!')
      }), 'BUTTON');
    this.setColour(160);
  }
};
```

---

## Особенности и параметры

- **onClick:**  
  Позволяет задать кастомную функцию, которая будет вызвана при нажатии на кнопку.
- **className:**  
  Позволяет добавить CSS-класс для стилизации кнопки.
- **disabled:**  
  Позволяет сделать кнопку неактивной (визуально и функционально).
- **validator:**  
  Позволяет валидировать или изменять значение кнопки при изменении.

---

## За что отвечает каждый метод

- **constructor:**  
  Инициализация поля, установка текста, валидатора и конфигурации.
- **initView:**  
  Создание и рендеринг кнопки в блоке, навешивание событий.
- **setValue:**  
  Изменение текста кнопки.
- **getValue:**  
  Получение текущего текста кнопки.
- **setEnabled:**  
  Включение/отключение кнопки.
- **dispose:**  
  Очистка ресурсов и удаление кнопки из DOM.

---

## Интеграция с Blockly

- Поле регистрируется через `Blockly.fieldRegistry.register('field_button', FieldButton);`
- Используется в блоках через `appendField(new FieldButton(...))`
- Поддерживает сериализацию/десериализацию Blockly

## Назначение
FieldButton предоставляет кастомное поле для Blockly блоков, которое отображается как кнопка. Расширяет стандартную систему полей Blockly и позволяет создавать интерактивные элементы в блоках.

## Основные переменные состояния
Не является компонентом, а экспортирует определение поля.

## Контексты (useContext)
Не использует контексты.

## Хуки
Не использует хуки.

## Экспортируемые элементы

### Определение поля
FieldButton определяется как кастомное поле Blockly:

```javascript
Blockly.Field.register('field_button', Blockly.Field, {
  // Определение поведения поля
});
```

### Структура поля
```javascript
{
  // Наследует от Blockly.Field
  // Добавляет кастомное поведение кнопки
}
```

## Использование в блоках

### В определении блока
```javascript
Blockly.Blocks['block_with_button'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("Текст")
        .appendField(new Blockly.FieldButton("Кнопка"), "BUTTON");
    this.setColour(160);
  }
};
```

### С кастомным обработчиком
```javascript
Blockly.Blocks['block_with_custom_button'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("Текст")
        .appendField(new Blockly.FieldButton("Кнопка", null, {
          onClick: function() {
            // Кастомная логика при клике
            console.log("Кнопка нажата!");
          }
        }), "BUTTON");
    this.setColour(160);
  }
};
```

## Параметры конструктора

### Основные параметры
- `text` — текст кнопки
- `validator` — валидатор значения (опционально)
- `config` — конфигурация кнопки (опционально)

### Конфигурация
```javascript
{
  onClick: function,    // Обработчик клика
  className: string,    // CSS класс
  disabled: boolean     // Состояние отключения
}
```

## Интеграция с Blockly

### Регистрация поля
Поле автоматически регистрируется при импорте:

```javascript
// В BlocklyWorkspace.jsx или CustomBlocks.jsx
import './FieldButton.js';
```

### Совместимость
- Совместим со всеми типами блоков Blockly
- Поддерживает стандартные свойства полей
- Интегрируется с системой сериализации
- Работает с системой тем

## Особенности
- Расширяет стандартную систему полей Blockly
- Поддерживает кастомные обработчики событий
- Интегрируется с системой стилей Blockly
- Поддерживает валидацию значений
- Совместим с системой сериализации/десериализации

## Стилизация
- Использует стандартные стили Blockly
- Поддерживает кастомные CSS классы
- Интегрируется с темой приложения
- Адаптивный дизайн

## Обработка событий
- Поддерживает клики мыши
- Интегрируется с системой событий Blockly
- Поддерживает кастомные колбэки
- Совместим с системой валидации

## Расширение
Для создания кастомного поля:
1. Наследовать от Blockly.Field
2. Определить необходимые методы
3. Зарегистрировать поле
4. Использовать в блоках

## Производительность
- Минимальные накладные расходы
- Эффективная обработка событий
- Оптимизированная отрисовка
- Совместимость с системой кэширования Blockly 